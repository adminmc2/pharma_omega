/* ============================================
   Puro Omega — Material Design 3
   Tokens + Componentes
   ============================================ */

:root {
    /* ===== M3 COLOR SYSTEM (Custom Puro Omega palette) ===== */
    /* Primary — Tech Cyan */
    --md-sys-color-primary: #31BEEF;
    --md-sys-color-on-primary: #FFFFFF;
    --md-sys-color-primary-container: #C4E8F7;
    --md-sys-color-on-primary-container: #00354A;

    /* Secondary — Visionary Violet */
    --md-sys-color-secondary: #994E95;
    --md-sys-color-on-secondary: #FFFFFF;
    --md-sys-color-secondary-container: #F3D8F0;
    --md-sys-color-on-secondary-container: #3B0838;

    /* Tertiary — Soft Blue */
    --md-sys-color-tertiary: #5B73A7;
    --md-sys-color-on-tertiary: #FFFFFF;
    --md-sys-color-tertiary-container: #D6E2FF;
    --md-sys-color-on-tertiary-container: #142D5E;

    /* Error */
    --md-sys-color-error: #BA1A1A;
    --md-sys-color-on-error: #FFFFFF;
    --md-sys-color-error-container: #FFDAD6;
    --md-sys-color-on-error-container: #410002;

    /* Surface & Background */
    --md-sys-color-surface: #FBF8FF;
    --md-sys-color-on-surface: #1B1B21;
    --md-sys-color-on-surface-variant: #45464F;
    --md-sys-color-surface-variant: #E2E1EC;
    --md-sys-color-surface-dim: #DBD9E3;
    --md-sys-color-surface-bright: #FBF8FF;
    --md-sys-color-surface-container-lowest: #FFFFFF;
    --md-sys-color-surface-container-low: #F5F2FC;
    --md-sys-color-surface-container: #EFEDF7;
    --md-sys-color-surface-container-high: #EAE7F1;
    --md-sys-color-surface-container-highest: #E4E1EB;
    --md-sys-color-inverse-surface: #303036;
    --md-sys-color-inverse-on-surface: #F2F0F9;
    --md-sys-color-outline: #76767F;
    --md-sys-color-outline-variant: #C6C5D0;

    /* ===== M3 TYPOGRAPHY ===== */
    --md-sys-typescale-font-brand: 'Quicksand', sans-serif;
    --md-sys-typescale-font-plain: 'Source Sans 3', sans-serif;

    /* Display */
    --md-sys-typescale-display-large: 500 57px/64px var(--md-sys-typescale-font-brand);
    --md-sys-typescale-display-medium: 500 45px/52px var(--md-sys-typescale-font-brand);
    --md-sys-typescale-display-small: 500 36px/44px var(--md-sys-typescale-font-brand);

    /* Headline */
    --md-sys-typescale-headline-large: 600 32px/40px var(--md-sys-typescale-font-brand);
    --md-sys-typescale-headline-medium: 600 28px/36px var(--md-sys-typescale-font-brand);
    --md-sys-typescale-headline-small: 600 24px/32px var(--md-sys-typescale-font-brand);

    /* Title */
    --md-sys-typescale-title-large: 600 22px/28px var(--md-sys-typescale-font-brand);
    --md-sys-typescale-title-medium: 500 16px/24px var(--md-sys-typescale-font-plain);
    --md-sys-typescale-title-small: 500 14px/20px var(--md-sys-typescale-font-plain);

    /* Body */
    --md-sys-typescale-body-large: 400 16px/24px var(--md-sys-typescale-font-plain);
    --md-sys-typescale-body-medium: 400 14px/20px var(--md-sys-typescale-font-plain);
    --md-sys-typescale-body-small: 400 12px/16px var(--md-sys-typescale-font-plain);

    /* Label */
    --md-sys-typescale-label-large: 500 14px/20px var(--md-sys-typescale-font-plain);
    --md-sys-typescale-label-medium: 500 12px/16px var(--md-sys-typescale-font-plain);
    --md-sys-typescale-label-small: 500 11px/16px var(--md-sys-typescale-font-plain);

    /* ===== M3 SHAPE ===== */
    --md-sys-shape-none: 0px;
    --md-sys-shape-extra-small: 4px;
    --md-sys-shape-small: 8px;
    --md-sys-shape-medium: 12px;
    --md-sys-shape-large: 16px;
    --md-sys-shape-extra-large: 28px;
    --md-sys-shape-full: 9999px;

    /* ===== M3 ELEVATION (shadow) ===== */
    --md-sys-elevation-0: none;
    --md-sys-elevation-1: 0px 1px 2px 0px rgba(0,0,0,0.30), 0px 1px 3px 1px rgba(0,0,0,0.15);
    --md-sys-elevation-2: 0px 1px 2px 0px rgba(0,0,0,0.30), 0px 2px 6px 2px rgba(0,0,0,0.15);
    --md-sys-elevation-3: 0px 1px 3px 0px rgba(0,0,0,0.30), 0px 4px 8px 3px rgba(0,0,0,0.15);

    /* ===== M3 MOTION ===== */
    --md-sys-motion-easing-standard: cubic-bezier(0.2, 0, 0, 1);
    --md-sys-motion-easing-standard-decelerate: cubic-bezier(0, 0, 0, 1);
    --md-sys-motion-easing-standard-accelerate: cubic-bezier(0.3, 0, 1, 1);
    --md-sys-motion-easing-emphasized: cubic-bezier(0.2, 0, 0, 1);
    --md-sys-motion-easing-emphasized-decelerate: cubic-bezier(0.05, 0.7, 0.1, 1);
    --md-sys-motion-easing-emphasized-accelerate: cubic-bezier(0.3, 0, 0.8, 0.15);
    --md-sys-motion-duration-short1: 50ms;
    --md-sys-motion-duration-short2: 100ms;
    --md-sys-motion-duration-short3: 150ms;
    --md-sys-motion-duration-short4: 200ms;
    --md-sys-motion-duration-medium1: 250ms;
    --md-sys-motion-duration-medium2: 300ms;
    --md-sys-motion-duration-medium3: 350ms;
    --md-sys-motion-duration-medium4: 400ms;
    --md-sys-motion-duration-long1: 450ms;
    --md-sys-motion-duration-long2: 500ms;

    /* ===== M3 STATE LAYERS ===== */
    --md-sys-state-hover: 0.08;
    --md-sys-state-focus: 0.10;
    --md-sys-state-pressed: 0.10;

    /* ===== SPACING (4dp grid) ===== */
    --space-4: 4px;
    --space-8: 8px;
    --space-12: 12px;
    --space-16: 16px;
    --space-20: 20px;
    --space-24: 24px;
    --space-32: 32px;
    --space-48: 48px;

    /* Safe areas */
    --safe-top: env(safe-area-inset-top, 0px);
    --safe-bottom: env(safe-area-inset-bottom, 0px);
}

/* ============================================
   MATERIAL SYMBOLS BASE
   ============================================ */
.material-symbols-rounded {
    font-variation-settings: 'FILL' 0, 'wght' 400, 'GRAD' 0, 'opsz' 24;
    font-size: 24px;
    line-height: 1;
    vertical-align: middle;
    user-select: none;
}

/* ============================================
   RESET
   ============================================ */
*, *::before, *::after {
    box-sizing: border-box;
    margin: 0;
    padding: 0;
}

html {
    font-size: 16px;
    -webkit-text-size-adjust: 100%;
    -webkit-tap-highlight-color: transparent;
}

body {
    /* Mood tint — JS sets these via data-mood-active */
    --mood-tint: 220, 200, 240;    /* default: lavanda (happy) */
    --mood-tint-strength: 0;       /* 0 = sin mood, se activa tras submit */

    font: var(--md-sys-typescale-body-large);
    background: var(--md-sys-color-surface);
    color: var(--md-sys-color-on-surface);
    min-height: 100vh;
    min-height: 100dvh;
    -webkit-font-smoothing: antialiased;
    position: relative;
}

/* Capa de tintado sutil global — apenas perceptible */
body::before {
    content: '';
    position: fixed;
    inset: 0;
    background: rgb(var(--mood-tint));
    opacity: var(--mood-tint-strength);
    pointer-events: none;
    z-index: 0;
    transition: opacity 1.2s var(--md-sys-motion-easing-standard),
                background 1.2s var(--md-sys-motion-easing-standard);
}

/* ============================================
   APP CONTAINER
   ============================================ */
.app-container {
    min-height: 100vh;
    min-height: 100dvh;
    display: flex;
    flex-direction: column;
    max-width: 480px;
    margin: 0 auto;
    position: relative;
    z-index: 1;
}

/* ============================================
   MAIN CONTENT (Welcome)
   ============================================ */
.main-content {
    flex: 1;
    display: flex;
    flex-direction: column;
    padding: var(--space-20);
    padding-top: calc(var(--space-20) + var(--safe-top));
    padding-bottom: calc(var(--space-20) + var(--safe-bottom));
    overflow-y: auto;
    -webkit-overflow-scrolling: touch;
}

/* ============================================
   TOP APP BAR (Header)
   ============================================ */
.header-row {
    display: flex;
    align-items: center;
    justify-content: space-between;
    min-height: 48px;
    flex-shrink: 0;
}

.header-actions {
    display: flex;
    gap: var(--space-4);
}

/* M3 Icon Button — Standard */
.header-icon-btn {
    width: 48px;
    height: 48px;
    border-radius: var(--md-sys-shape-full);
    border: none;
    padding: 0;
    cursor: pointer;
    background: transparent;
    color: var(--md-sys-color-on-surface-variant);
    display: flex;
    align-items: center;
    justify-content: center;
    position: relative;
    overflow: hidden;
    transition:
        background-color var(--md-sys-motion-duration-short4) var(--md-sys-motion-easing-standard),
        color var(--md-sys-motion-duration-short4) var(--md-sys-motion-easing-standard);
}

.header-icon-btn::before {
    content: '';
    position: absolute;
    inset: 0;
    border-radius: inherit;
    background: currentColor;
    opacity: 0;
    transition: opacity var(--md-sys-motion-duration-short4) var(--md-sys-motion-easing-standard);
    pointer-events: none;
}

.header-icon-btn:hover::before {
    opacity: var(--md-sys-state-hover);
}

.header-icon-btn:active::before {
    opacity: var(--md-sys-state-pressed);
}

.header-icon-btn .material-symbols-rounded {
    font-size: 24px;
    position: relative;
    z-index: 1;
}

/* M3 Profile Avatar */
.profile-btn {
    width: 40px;
    height: 40px;
    border-radius: var(--md-sys-shape-full);
    border: none;
    padding: 0;
    cursor: pointer;
    overflow: hidden;
    background: var(--md-sys-color-primary-container);
    flex-shrink: 0;
    transition: transform var(--md-sys-motion-duration-short4) var(--md-sys-motion-easing-standard);
}

.profile-btn:hover {
    transform: scale(1.04);
}

.profile-btn:active {
    transform: scale(0.96);
}

.profile-img {
    width: 100%;
    height: 100%;
    object-fit: cover;
}

/* ============================================
   GREETING — Headline typography
   ============================================ */
.greeting-section {
    margin-top: var(--space-24);
    margin-bottom: var(--space-16);
    flex-shrink: 0;
}

.greeting-title {
    font: var(--md-sys-typescale-headline-medium);
    color: var(--md-sys-color-on-surface);
    letter-spacing: 0;
}

.wave {
    display: inline-block;
    animation: wave 2.5s ease-in-out 1;
    transform-origin: 70% 70%;
    font-size: 28px;
}

@keyframes wave {
    0%, 100% { transform: rotate(0deg); }
    15% { transform: rotate(10deg); }
    30% { transform: rotate(-4deg); }
    45% { transform: rotate(8deg); }
    60% { transform: rotate(0deg); }
}

/* ============================================
   BENTO CARD GRID
   ============================================ */
.bento-grid {
    display: grid;
    grid-template-columns: 55fr 45fr;
    grid-template-rows: 1fr 1fr;
    gap: var(--space-12);
    margin-bottom: var(--space-16);
    height: 280px;
    flex-shrink: 0;
}

/* Base card — M3 Surface Container */
.bento-card {
    background: var(--md-sys-color-surface-container);
    border-radius: var(--md-sys-shape-extra-large);
    border: none;
    cursor: pointer;
    padding: var(--space-20);
    display: flex;
    flex-direction: column;
    position: relative;
    overflow: hidden;
    text-align: left;
    box-shadow: var(--md-sys-elevation-1);
    transition:
        transform var(--md-sys-motion-duration-short4) var(--md-sys-motion-easing-standard),
        box-shadow var(--md-sys-motion-duration-short4) var(--md-sys-motion-easing-standard);
}

.bento-card:hover {
    transform: scale(1.02);
    box-shadow: var(--md-sys-elevation-2);
}

.bento-card:active {
    transform: scale(0.98);
    box-shadow: var(--md-sys-elevation-1);
}

/* State layer overlay (M3) */
.bento-card::after {
    content: '';
    position: absolute;
    inset: 0;
    border-radius: inherit;
    background: var(--md-sys-color-primary);
    opacity: 0;
    transition: opacity var(--md-sys-motion-duration-short4) var(--md-sys-motion-easing-standard);
    pointer-events: none;
}

.bento-card:hover::after {
    opacity: var(--md-sys-state-hover);
}

.bento-card:active::after {
    opacity: var(--md-sys-state-pressed);
}

/* Card 1: Mood — tall, left, spans 2 rows */
.bento-card--mood {
    grid-row: 1 / 3;
    background: linear-gradient(
        160deg,
        var(--md-sys-color-secondary-container) 0%,
        var(--md-sys-color-surface-container) 100%
    );
    align-items: center;
    justify-content: center;
    text-align: center;
    transition:
        transform var(--md-sys-motion-duration-short4) var(--md-sys-motion-easing-standard),
        box-shadow var(--md-sys-motion-duration-short4) var(--md-sys-motion-easing-standard),
        background 1s var(--md-sys-motion-easing-standard);
}

/* Cuando el mood está activo, la tarjeta refleja el color del mood */
body[data-mood-active] .bento-card--mood {
    background: linear-gradient(
        160deg,
        rgba(var(--mood-tint), 0.35) 0%,
        var(--md-sys-color-surface-container) 100%
    );
}

.bento-card--mood::after {
    background: var(--md-sys-color-secondary);
}

/* Card 2: Orb Voice — right top */
.bento-card--voice {
    align-items: center;
    justify-content: center;
    padding: var(--space-8);
    background: var(--md-sys-color-surface-container-low);
}

.bento-card--voice .orb-container {
    width: 100%;
    flex: 1;
    min-height: 0;
    overflow: visible;
    display: flex;
    align-items: center;
    justify-content: center;
}

.bento-card--voice .orb-container canvas {
    display: block;
    overflow: visible;
    margin: auto;
}

.bento-card--voice::after {
    background: var(--md-sys-color-primary);
}

.bento-card--voice.listening {
    box-shadow:
        var(--md-sys-elevation-2),
        0 0 0 0px rgba(49, 190, 239, 0.3);
    animation: cardPulse 2s var(--md-sys-motion-easing-standard) infinite;
}

@keyframes cardPulse {
    0%, 100% {
        box-shadow:
            var(--md-sys-elevation-2),
            0 0 0 0px rgba(49, 190, 239, 0.3);
    }
    50% {
        box-shadow:
            var(--md-sys-elevation-2),
            0 0 0 6px rgba(49, 190, 239, 0);
    }
}

/* Card 3: Plan — right bottom */
.bento-card--plan {
    align-items: center;
    justify-content: center;
    text-align: center;
    background: linear-gradient(
        160deg,
        var(--md-sys-color-tertiary-container) 0%,
        var(--md-sys-color-surface-container) 100%
    );
}

.bento-card--plan::after {
    background: var(--md-sys-color-tertiary);
}

/* Card typography */

/* Mood face SVG icon (kawaii style — large centered) */
.mood-face {
    width: 80%;
    max-width: 120px;
    flex: 1;
    min-height: 0;
    max-height: 55%;
    color: var(--md-sys-color-on-secondary-container);
    opacity: 0.65;
    margin-bottom: var(--space-8);
    position: relative;
    z-index: 1;
}

/* Plan clipboard SVG icon */
.plan-icon {
    width: 80%;
    max-width: 64px;
    flex: 1;
    min-height: 0;
    max-height: 55%;
    color: var(--md-sys-color-on-tertiary-container);
    opacity: 0.6;
    margin-bottom: var(--space-8);
    position: relative;
    z-index: 1;
}

.bento-card__title {
    font: var(--md-sys-typescale-title-medium);
    color: var(--md-sys-color-on-surface);
    position: relative;
    z-index: 1;
}

.bento-card__subtitle {
    font: var(--md-sys-typescale-body-small);
    color: var(--md-sys-color-on-surface-variant);
    margin-top: var(--space-4);
    position: relative;
    z-index: 1;
}

.bento-card__label {
    font: var(--md-sys-typescale-label-large);
    color: var(--md-sys-color-on-surface-variant);
    margin-top: var(--space-4);
    position: relative;
    z-index: 1;
    text-align: center;
}

/* ============================================
   FAQ SECTION
   ============================================ */
.faq-section {
    margin-top: var(--space-24);
    padding-bottom: var(--space-32);
    flex-shrink: 0;
}

.faq-section__title {
    font: var(--md-sys-typescale-title-large);
    color: var(--md-sys-color-on-surface);
    margin-bottom: var(--space-16);
}

.faq-category {
    margin-bottom: var(--space-20);
}

.faq-category__label {
    font: var(--md-sys-typescale-label-large);
    color: var(--md-sys-color-on-surface-variant);
    display: flex;
    align-items: center;
    gap: var(--space-8);
    margin-bottom: var(--space-12);
    text-transform: uppercase;
    letter-spacing: 0.5px;
}

.faq-category__label .material-symbols-rounded {
    font-size: 18px;
    color: var(--md-sys-color-primary);
}

/* M3 Suggestion Chips */
.faq-chips {
    display: flex;
    flex-wrap: wrap;
    gap: var(--space-8);
}

.faq-chip {
    font: var(--md-sys-typescale-label-large);
    color: var(--md-sys-color-on-surface);
    background: var(--md-sys-color-surface-container-lowest);
    border: 1px solid var(--md-sys-color-outline-variant);
    border-radius: var(--md-sys-shape-small);
    padding: var(--space-8) var(--space-16);
    cursor: pointer;
    position: relative;
    overflow: hidden;
    transition:
        background-color var(--md-sys-motion-duration-short4) var(--md-sys-motion-easing-standard),
        border-color var(--md-sys-motion-duration-short4) var(--md-sys-motion-easing-standard),
        transform var(--md-sys-motion-duration-short4) var(--md-sys-motion-easing-standard);
}

.faq-chip:hover {
    background: var(--md-sys-color-surface-container-high);
    border-color: var(--md-sys-color-outline);
}

.faq-chip:active {
    transform: scale(0.97);
}

/* ============================================
   M3 SEARCH BAR — Extra Large shape (28dp)
   ============================================ */
.search-container {
    display: flex;
    align-items: center;
    background: var(--md-sys-color-surface-container-high);
    border-radius: var(--md-sys-shape-extra-large);
    padding: var(--space-4) var(--space-8);
    min-height: 56px;
    flex-shrink: 0;
    transition:
        background-color var(--md-sys-motion-duration-short4) var(--md-sys-motion-easing-standard),
        box-shadow var(--md-sys-motion-duration-short4) var(--md-sys-motion-easing-standard);
}

.search-container:focus-within {
    background: var(--md-sys-color-surface-container-highest);
    box-shadow: var(--md-sys-elevation-2);
}

.search-icon-btn {
    width: 48px;
    height: 48px;
    border: none;
    border-radius: var(--md-sys-shape-full);
    background: transparent;
    color: var(--md-sys-color-on-surface);
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    flex-shrink: 0;
}

.search-icon-btn .material-symbols-rounded {
    font-size: 24px;
}

.search-input {
    flex: 1;
    border: none;
    background: transparent;
    font: var(--md-sys-typescale-body-large);
    padding: var(--space-8) var(--space-4);
    color: var(--md-sys-color-on-surface);
    min-width: 0;
}

.search-input::placeholder {
    color: var(--md-sys-color-on-surface-variant);
}

.search-input:focus {
    outline: none;
}

/* M3 Tonal Icon Button (mic) */
.mic-btn {
    width: 48px;
    height: 48px;
    border: none;
    border-radius: var(--md-sys-shape-full);
    background: transparent;
    color: var(--md-sys-color-on-surface-variant);
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    flex-shrink: 0;
    position: relative;
    overflow: hidden;
    transition:
        background-color var(--md-sys-motion-duration-short4) var(--md-sys-motion-easing-standard),
        color var(--md-sys-motion-duration-short4) var(--md-sys-motion-easing-standard);
}

.mic-btn::before {
    content: '';
    position: absolute;
    inset: 0;
    border-radius: inherit;
    background: currentColor;
    opacity: 0;
    transition: opacity var(--md-sys-motion-duration-short4) var(--md-sys-motion-easing-standard);
    pointer-events: none;
}

.mic-btn:hover::before {
    opacity: var(--md-sys-state-hover);
}

.mic-btn.recording {
    background: var(--md-sys-color-error);
    color: var(--md-sys-color-on-error);
    animation: pulse-record 1.5s var(--md-sys-motion-easing-standard) infinite;
}

.mic-btn.recording::before {
    display: none;
}

@keyframes pulse-record {
    0%, 100% { transform: scale(1); }
    50% { transform: scale(1.08); }
}

.mic-btn .material-symbols-rounded {
    font-size: 24px;
    position: relative;
    z-index: 1;
}

/* Voice Status */
.voice-status {
    text-align: center;
    font: var(--md-sys-typescale-body-small);
    color: var(--md-sys-color-on-surface-variant);
    margin-top: var(--space-8);
    min-height: 16px;
    flex-shrink: 0;
    transition: color var(--md-sys-motion-duration-short4) var(--md-sys-motion-easing-standard);
}

.voice-status.active {
    color: var(--md-sys-color-error);
}

/* ============================================
   M3 SCREEN TRANSITIONS
   ============================================ */
.hidden {
    display: none !important;
}

.welcome-screen {
    transition:
        opacity var(--md-sys-motion-duration-medium2) var(--md-sys-motion-easing-emphasized-accelerate),
        transform var(--md-sys-motion-duration-medium2) var(--md-sys-motion-easing-emphasized-accelerate);
}

.welcome-screen.fade-out {
    opacity: 0;
    transform: translateY(-12px) scale(0.98);
}

.chat-screen {
    display: flex;
    flex-direction: column;
    height: 100vh;
    height: 100dvh;
    padding: 0;
    animation: screenEnter var(--md-sys-motion-duration-medium4) var(--md-sys-motion-easing-emphasized-decelerate);
}

@keyframes screenEnter {
    from {
        opacity: 0;
        transform: translateY(16px) scale(0.98);
    }
    to {
        opacity: 1;
        transform: translateY(0) scale(1);
    }
}

/* ============================================
   M3 CHAT — Top App Bar
   ============================================ */
.chat-header {
    display: flex;
    align-items: center;
    padding: var(--space-8) var(--space-4);
    padding-top: calc(var(--space-8) + var(--safe-top));
    background: var(--md-sys-color-surface);
    gap: var(--space-4);
    min-height: 64px;
    transition: background-color 1s var(--md-sys-motion-easing-standard);
}

body[data-mood-active] .chat-header {
    background: color-mix(in srgb, rgb(var(--mood-tint)) 6%, var(--md-sys-color-surface));
}

/* M3 Navigation Icon Button */
.back-btn {
    width: 48px;
    height: 48px;
    border: none;
    border-radius: var(--md-sys-shape-full);
    background: transparent;
    color: var(--md-sys-color-on-surface);
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    position: relative;
    overflow: hidden;
    transition: background-color var(--md-sys-motion-duration-short4) var(--md-sys-motion-easing-standard);
}

.back-btn::before {
    content: '';
    position: absolute;
    inset: 0;
    border-radius: inherit;
    background: currentColor;
    opacity: 0;
    transition: opacity var(--md-sys-motion-duration-short4) var(--md-sys-motion-easing-standard);
    pointer-events: none;
}

.back-btn:hover::before {
    opacity: var(--md-sys-state-hover);
}

.back-btn:active::before {
    opacity: var(--md-sys-state-pressed);
}

.back-btn .material-symbols-rounded {
    font-size: 24px;
    position: relative;
    z-index: 1;
}

.chat-title {
    flex: 1;
    display: flex;
    flex-direction: column;
    padding-left: var(--space-4);
}

.chat-title-text {
    font: var(--md-sys-typescale-title-large);
    color: var(--md-sys-color-on-surface);
}

.chat-status {
    font: var(--md-sys-typescale-label-medium);
    color: var(--md-sys-color-primary);
    letter-spacing: 0.5px;
}

/* ============================================
   M3 CHAT MESSAGES
   ============================================ */
.chat-messages {
    flex: 1;
    overflow-y: auto;
    padding: var(--space-16);
    display: flex;
    flex-direction: column;
    gap: var(--space-8);
    background: var(--md-sys-color-surface);
    transition: background-color 1s var(--md-sys-motion-easing-standard);
}

body[data-mood-active] .chat-messages {
    background: color-mix(in srgb, rgb(var(--mood-tint)) 4%, var(--md-sys-color-surface));
}

.message {
    max-width: 85%;
    padding: var(--space-12) var(--space-16);
    font: var(--md-sys-typescale-body-large);
    animation: messageEnter var(--md-sys-motion-duration-medium2) var(--md-sys-motion-easing-emphasized-decelerate);
}

@keyframes messageEnter {
    from {
        opacity: 0;
        transform: translateY(8px) scale(0.97);
    }
    to {
        opacity: 1;
        transform: translateY(0) scale(1);
    }
}

/* User message — Primary container */
.message.user {
    background: var(--md-sys-color-primary);
    color: var(--md-sys-color-on-primary);
    align-self: flex-end;
    border-radius: var(--md-sys-shape-large) var(--md-sys-shape-large) var(--md-sys-shape-extra-small) var(--md-sys-shape-large);
}

/* Assistant message — Surface Container */
.message.assistant {
    background: var(--md-sys-color-surface-container);
    color: var(--md-sys-color-on-surface);
    align-self: flex-start;
    border-radius: var(--md-sys-shape-large) var(--md-sys-shape-large) var(--md-sys-shape-large) var(--md-sys-shape-extra-small);
    transition: background-color 1s var(--md-sys-motion-easing-standard);
}

body[data-mood-active] .message.assistant {
    background: color-mix(in srgb, rgb(var(--mood-tint)) 10%, var(--md-sys-color-surface-container));
}

.message.assistant.typing {
    color: var(--md-sys-color-on-surface-variant);
}

/* Typing indicator */
.typing-indicator {
    display: flex;
    gap: 6px;
    padding: var(--space-8) 0;
}

.typing-indicator span {
    width: 8px;
    height: 8px;
    background: var(--md-sys-color-on-surface-variant);
    border-radius: var(--md-sys-shape-full);
    animation: typingBounce 1.4s var(--md-sys-motion-easing-standard) infinite;
}

.typing-indicator span:nth-child(2) {
    animation-delay: 0.15s;
}

.typing-indicator span:nth-child(3) {
    animation-delay: 0.3s;
}

@keyframes typingBounce {
    0%, 60%, 100% { transform: translateY(0); opacity: 0.4; }
    30% { transform: translateY(-6px); opacity: 1; }
}

/* ============================================
   M3 CHAT INPUT BAR
   ============================================ */
.chat-input-container {
    display: flex;
    align-items: center;
    padding: var(--space-8) var(--space-12);
    padding-bottom: calc(var(--space-12) + var(--safe-bottom));
    background: var(--md-sys-color-surface-container-low);
    gap: var(--space-8);
    transition: background-color 1s var(--md-sys-motion-easing-standard);
}

body[data-mood-active] .chat-input-container {
    background: color-mix(in srgb, rgb(var(--mood-tint)) 5%, var(--md-sys-color-surface-container-low));
}

.chat-input {
    flex: 1;
    border: 1px solid var(--md-sys-color-outline-variant);
    border-radius: var(--md-sys-shape-extra-large);
    background: var(--md-sys-color-surface-container-lowest);
    font: var(--md-sys-typescale-body-large);
    padding: var(--space-12) var(--space-16);
    color: var(--md-sys-color-on-surface);
    min-width: 0;
    transition:
        border-color var(--md-sys-motion-duration-short4) var(--md-sys-motion-easing-standard),
        box-shadow var(--md-sys-motion-duration-short4) var(--md-sys-motion-easing-standard);
}

.chat-input::placeholder {
    color: var(--md-sys-color-on-surface-variant);
}

.chat-input:focus {
    outline: none;
    border-color: var(--md-sys-color-primary);
    box-shadow: 0 0 0 1px var(--md-sys-color-primary);
}

/* M3 Icon Buttons in chat */
.chat-mic-btn,
.chat-send-btn {
    width: 48px;
    height: 48px;
    border: none;
    border-radius: var(--md-sys-shape-full);
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    flex-shrink: 0;
    position: relative;
    overflow: hidden;
    transition:
        background-color var(--md-sys-motion-duration-short4) var(--md-sys-motion-easing-standard),
        color var(--md-sys-motion-duration-short4) var(--md-sys-motion-easing-standard),
        transform var(--md-sys-motion-duration-short4) var(--md-sys-motion-easing-standard);
}

/* Mic — Standard Icon Button */
.chat-mic-btn {
    background: transparent;
    color: var(--md-sys-color-on-surface-variant);
}

.chat-mic-btn::before {
    content: '';
    position: absolute;
    inset: 0;
    border-radius: inherit;
    background: currentColor;
    opacity: 0;
    transition: opacity var(--md-sys-motion-duration-short4) var(--md-sys-motion-easing-standard);
    pointer-events: none;
}

.chat-mic-btn:hover::before {
    opacity: var(--md-sys-state-hover);
}

.chat-mic-btn.recording {
    background: var(--md-sys-color-error);
    color: var(--md-sys-color-on-error);
    animation: pulse-record 1.5s var(--md-sys-motion-easing-standard) infinite;
}

.chat-mic-btn.recording::before {
    display: none;
}

/* Send — M3 Filled Tonal Icon Button */
.chat-send-btn {
    background: var(--md-sys-color-primary);
    color: var(--md-sys-color-on-primary);
}

.chat-send-btn::before {
    content: '';
    position: absolute;
    inset: 0;
    border-radius: inherit;
    background: var(--md-sys-color-on-primary);
    opacity: 0;
    transition: opacity var(--md-sys-motion-duration-short4) var(--md-sys-motion-easing-standard);
    pointer-events: none;
}

.chat-send-btn:hover::before {
    opacity: var(--md-sys-state-hover);
}

.chat-send-btn:active {
    transform: scale(0.92);
}

.chat-mic-btn .material-symbols-rounded,
.chat-send-btn .material-symbols-rounded {
    font-size: 24px;
    position: relative;
    z-index: 1;
}

/* ============================================
   M3 FAB — Floating Orb
   ============================================ */
.orb-floating {
    position: fixed;
    bottom: 100px;
    right: 20px;
    width: 56px;
    height: 56px;
    border: none;
    border-radius: var(--md-sys-shape-large);
    background: var(--md-sys-color-primary-container);
    cursor: pointer;
    padding: 0;
    box-shadow: var(--md-sys-elevation-3);
    z-index: 100;
    overflow: hidden;
    transition:
        transform var(--md-sys-motion-duration-medium1) var(--md-sys-motion-easing-emphasized),
        box-shadow var(--md-sys-motion-duration-medium1) var(--md-sys-motion-easing-emphasized),
        border-radius var(--md-sys-motion-duration-medium1) var(--md-sys-motion-easing-emphasized),
        background-color 1s var(--md-sys-motion-easing-standard);
}

body[data-mood-active] .orb-floating {
    background: color-mix(in srgb, rgb(var(--mood-tint)) 20%, var(--md-sys-color-primary-container));
}

.orb-floating:hover {
    transform: scale(1.04);
    box-shadow: var(--md-sys-elevation-3);
}

.orb-floating:active {
    transform: scale(0.95);
}

.orb-floating.listening {
    border-radius: var(--md-sys-shape-medium);
    animation: fabPulse 2s var(--md-sys-motion-easing-standard) infinite;
}

@keyframes fabPulse {
    0%, 100% {
        transform: scale(1);
        box-shadow:
            var(--md-sys-elevation-3),
            0 0 0 0px rgba(49, 190, 239, 0.3);
    }
    50% {
        transform: scale(1.06);
        box-shadow:
            var(--md-sys-elevation-3),
            0 0 0 8px rgba(49, 190, 239, 0);
    }
}

.orb-container-mini {
    width: 100%;
    height: 100%;
    overflow: hidden;
    border-radius: inherit;
}

/* ============================================
   MOOD OVERLAY — Full-screen selector
   Fondo dinámico controlado por --mood-bg y --mood-fg via JS
   ============================================ */
.mood-overlay {
    --mood-bg: #F3D8F0;  /* default: happy = secondary-container */
    --mood-fg: #3B0838;  /* default: on-secondary-container */

    position: fixed;
    inset: 0;
    z-index: 200;
    background: var(--mood-bg);
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    padding: var(--space-20);
    padding-top: calc(var(--space-16) + var(--safe-top));
    padding-bottom: calc(var(--space-32) + var(--safe-bottom));
    overflow-y: auto;
    -webkit-overflow-scrolling: touch;
    transition: background 0.5s var(--md-sys-motion-easing-standard);
}

.mood-overlay.hidden {
    display: none !important;
}

@keyframes moodOverlayEnter {
    from {
        opacity: 0;
        transform: translateY(40px) scale(0.96);
    }
    to {
        opacity: 1;
        transform: translateY(0) scale(1);
    }
}

@keyframes moodOverlayExit {
    from {
        opacity: 1;
        transform: translateY(0) scale(1);
    }
    to {
        opacity: 0;
        transform: translateY(24px) scale(0.97);
    }
}

/* Top bar: close + info */
.mood-overlay__topbar {
    display: flex;
    justify-content: space-between;
    width: 100%;
    position: absolute;
    top: calc(var(--space-12) + var(--safe-top));
    left: 0;
    padding: 0 var(--space-16);
}

.mood-overlay__close,
.mood-overlay__info {
    width: 44px;
    height: 44px;
    border-radius: var(--md-sys-shape-full);
    border: none;
    background: transparent;
    color: var(--mood-fg);
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    position: relative;
    overflow: hidden;
    opacity: 0.7;
    transition:
        opacity var(--md-sys-motion-duration-short4) var(--md-sys-motion-easing-standard),
        color 0.5s var(--md-sys-motion-easing-standard);
}

.mood-overlay__close:active,
.mood-overlay__info:active {
    opacity: 1;
}

/* Question */
.mood-overlay__question {
    font: var(--md-sys-typescale-headline-small);
    color: var(--mood-fg);
    text-align: center;
    margin-bottom: var(--space-24);
    flex-shrink: 0;
    transition: color 0.5s var(--md-sys-motion-easing-standard);
}

/* Animated face — grande y dominante */
.mood-overlay__face-container {
    width: 60vw;
    max-width: 280px;
    aspect-ratio: 1;
    display: flex;
    align-items: center;
    justify-content: center;
    flex-shrink: 0;
    margin-bottom: var(--space-8);
}

.mood-overlay__face {
    width: 100%;
    height: 100%;
    color: var(--mood-fg);
    opacity: 0.7;
    transition: color 0.5s var(--md-sys-motion-easing-standard);
}

/* Mood label — grande y bold */
.mood-overlay__label {
    font: var(--md-sys-typescale-headline-medium);
    color: var(--mood-fg);
    text-transform: uppercase;
    letter-spacing: 2px;
    margin-bottom: var(--space-24);
    min-height: 36px;
    text-align: center;
    flex-shrink: 0;
    font-weight: 700;
    transition: color 0.5s var(--md-sys-motion-easing-standard);
}

/* Slider — minimalista, track fino oscuro */
.mood-overlay__slider-container {
    display: flex;
    flex-direction: column;
    align-items: center;
    width: 100%;
    max-width: 300px;
    margin-bottom: var(--space-24);
    flex-shrink: 0;
    gap: var(--space-8);
}

.mood-overlay__slider-track {
    width: 100%;
}

.mood-overlay__slider {
    -webkit-appearance: none;
    appearance: none;
    width: 100%;
    height: 4px;
    border-radius: var(--md-sys-shape-full);
    background: var(--mood-fg);
    opacity: 0.25;
    outline: none;
    cursor: pointer;
    transition: background 0.5s var(--md-sys-motion-easing-standard);
}

.mood-overlay__slider::-webkit-slider-thumb {
    -webkit-appearance: none;
    appearance: none;
    width: 24px;
    height: 24px;
    border-radius: var(--md-sys-shape-full);
    background: var(--mood-fg);
    border: none;
    cursor: pointer;
    opacity: 0.6;
    transition:
        transform var(--md-sys-motion-duration-short4) var(--md-sys-motion-easing-standard),
        background 0.5s var(--md-sys-motion-easing-standard);
}

.mood-overlay__slider::-webkit-slider-thumb:active {
    transform: scale(1.25);
}

.mood-overlay__slider::-moz-range-thumb {
    width: 24px;
    height: 24px;
    border-radius: var(--md-sys-shape-full);
    background: var(--mood-fg);
    border: none;
    cursor: pointer;
    opacity: 0.6;
}

.mood-overlay__slider::-moz-range-track {
    height: 4px;
    border-radius: var(--md-sys-shape-full);
    background: var(--mood-fg);
    opacity: 0.25;
}

/* Endpoint labels debajo del slider */
.mood-overlay__slider-labels {
    display: flex;
    justify-content: space-between;
    width: 100%;
}

.mood-overlay__slider-endpoint {
    font: var(--md-sys-typescale-label-medium);
    color: var(--mood-fg);
    opacity: 0.5;
    flex-shrink: 0;
    transition: color 0.5s var(--md-sys-motion-easing-standard);
}

/* Submit button — monocromático con el tono del mood */
.mood-overlay__submit {
    font: var(--md-sys-typescale-label-large);
    color: var(--mood-bg);
    background: var(--mood-fg);
    border: none;
    border-radius: var(--md-sys-shape-full);
    padding: var(--space-16) var(--space-48);
    cursor: pointer;
    min-height: 48px;
    position: relative;
    overflow: hidden;
    opacity: 0.8;
    transition:
        transform var(--md-sys-motion-duration-short4) var(--md-sys-motion-easing-standard),
        opacity var(--md-sys-motion-duration-short4) var(--md-sys-motion-easing-standard),
        background 0.5s var(--md-sys-motion-easing-standard),
        color 0.5s var(--md-sys-motion-easing-standard);
    flex-shrink: 0;
    margin-bottom: var(--space-16);
}

.mood-overlay__submit:active {
    transform: scale(0.96);
    opacity: 1;
}

.mood-overlay__submit:disabled {
    opacity: 0.4;
    cursor: default;
}

/* AI reaction */
.mood-overlay__reaction {
    font: var(--md-sys-typescale-body-medium);
    color: var(--mood-fg);
    text-align: center;
    max-width: 300px;
    min-height: 20px;
    opacity: 0;
    transform: translateY(8px);
    transition:
        opacity var(--md-sys-motion-duration-medium2) var(--md-sys-motion-easing-emphasized-decelerate),
        transform var(--md-sys-motion-duration-medium2) var(--md-sys-motion-easing-emphasized-decelerate),
        color 0.5s var(--md-sys-motion-easing-standard);
}

.mood-overlay__reaction.visible {
    opacity: 0.7;
    transform: translateY(0);
}

/* ============================================
   RESPONSIVE
   ============================================ */
@media (min-width: 600px) {
    .app-container {
        max-width: 520px;
    }

    .greeting-title {
        font: var(--md-sys-typescale-headline-large);
    }

    .bento-grid {
        height: 320px;
    }

    .orb-floating {
        bottom: 120px;
        right: calc(50% - 260px + 20px);
    }
}
